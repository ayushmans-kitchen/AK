{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile | Ayushman's Kitchen</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
:root {
    --color-gold: #d4af37;
    --color-bg-deep: #050505;
    --color-bg-card: #0c0c0c;
    --color-bg-sidebar: #000000;
    --color-text: #ffffff;
    --color-text-muted: #888888;
    --color-border: #1a1a1a;
    --color-danger: #ff4444;
    --color-success: #4ade80;
    --sb-width: 260px;
    --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* RESET & BASE */
* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

body { 
    font-family: 'Montserrat', sans-serif; 
    background-color: var(--color-bg-deep); 
    color: var(--color-text); 
    line-height: 1.4; 
    -webkit-font-smoothing: antialiased;
}

/* CUSTOM SCROLLBAR */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--color-bg-deep); }
::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: var(--color-gold); }

/* MOBILE HEADER */
#nav-toggle { display: none; }

.mobile-header {
    display: none; 
    position: fixed; 
    top: 0; 
    width: 100%; 
    height: 60px;
    background: #000; 
    padding: 0 1.5rem; 
    align-items: center; 
    justify-content: space-between;
    z-index: 2100; 
    border-bottom: 1px solid var(--color-border);
}

.hamburger { 
    width: 25px; 
    height: 16px; 
    display: flex; 
    flex-direction: column; 
    justify-content: space-between; 
}

.hamburger span { 
    height: 2px; 
    width: 100%; 
    background: var(--color-gold); 
    border-radius: 10px; 
}

/* MAIN CONTENT AREA */
.main-content { 
    margin-left: var(--sb-width); 
    padding: 1.5rem 2.5rem; 
    transition: var(--transition); 
    min-height: 100vh; 
}

.header-main { 
    margin-bottom: 1.5rem; 
    border-bottom: 1px solid var(--color-border); 
    padding-bottom: 0.75rem; 
}

.header-main h1 { 
    font-family: 'Playfair Display', serif; 
    color: var(--color-gold); 
    font-size: 1.4rem; /* Small & consistent across all pages */
    text-transform: uppercase; 
    letter-spacing: -0.5px;
    font-weight: 800;
}

/* PROFILE FORM CARD */
.profile-card { 
    background: var(--color-bg-card); 
    border: 1px solid var(--color-border); 
    border-radius: 12px; 
    padding: 1.5rem 2rem; 
    margin-bottom: 2rem; 
}

.details-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.25rem;
    margin-bottom: 1.5rem;
}

.input-group { 
    display: flex; 
    flex-direction: column; 
    gap: 0.4rem; 
    margin-bottom: 0.75rem;
}

.input-group label { 
    font-size: 0.65rem; 
    color: var(--color-gold); 
    text-transform: uppercase; 
    font-weight: 700; 
    letter-spacing: 0.5px; 
}

.input-group input, 
.input-group select {
    background: #080808; 
    border: 1px solid var(--color-border); 
    color: white; 
    padding: 10px 12px; 
    border-radius: 6px;
    font-family: inherit; 
    font-size: 0.85rem; 
    outline: none; 
    transition: 0.3s; 
    width: 100%;
}

.input-group input:focus, 
.input-group select:focus { 
    border-color: var(--color-gold); 
}

.input-group input[readonly] {
    opacity: 0.6;
    background: transparent;
    border-style: dashed;
}

/* BUTTONS */
.button-row { 
    display: flex; 
    gap: 1rem; 
    margin-top: 1rem;
}

.btn { 
    flex: 1; 
    padding: 12px; 
    border-radius: 6px; 
    font-weight: 800; 
    cursor: pointer; 
    border: none; 
    font-size: 0.7rem; 
    transition: 0.3s; 
    text-transform: uppercase; 
    letter-spacing: 1px; 
}

.btn-save { background: var(--color-gold); color: black; }
.btn-renew { background: transparent; border: 1px solid var(--color-gold); color: var(--color-gold); }

.btn:hover { transform: translateY(-2px); opacity: 0.9; }

/* CHECKBOXES */
.field-group { margin-top: 0.5rem; margin-bottom: 1.5rem; }
.field-label { 
    font-size: 0.6rem; 
    font-weight: 800; 
    color: var(--color-gold); 
    text-transform: uppercase; 
    margin-bottom: 1rem; 
    display: block; 
}

.check-row { display: flex; flex-wrap: wrap; gap: 20px; }

.inline-label { 
    display: flex; 
    align-items: center; 
    gap: 8px; 
    cursor: pointer; 
    font-size: 0.75rem; 
    color: #e0e0e0; 
}

.inline-label input { 
    accent-color: var(--color-gold); 
    width: 16px; 
    height: 16px; 
}

/* TABLES SECTION */
.section-container { margin-bottom: 2.5rem; }
.section-container h2 { 
    font-family: 'Playfair Display', serif; 
    color: var(--color-gold); 
    font-size: 1.1rem; 
    margin-bottom: 1rem; 
}

.table-wrapper { 
    background: var(--color-bg-card); 
    border: 1px solid var(--color-border); 
    border-radius: 8px; 
    overflow-x: auto; /* Enable scroll */
    -webkit-overflow-scrolling: touch;
}

table { width: 100%; border-collapse: collapse; }

thead th { 
    background: #080808; 
    color: var(--color-gold); 
    font-size: 0.6rem; 
    text-transform: uppercase; 
    padding: 12px 15px; 
    border-bottom: 2px solid var(--color-gold); 
    font-weight: 800; 
    text-align: left;
    white-space: nowrap;
}

tbody td { 
    padding: 12px 15px; 
    font-size: 0.8rem; 
    border-bottom: 1px solid var(--color-border); 
    color: #efefef; 
    white-space: nowrap;
}

/* ADDRESS CELL WRAP */
td.address-cell { white-space: normal; min-width: 200px; }

/* BADGES */
.badge { 
    padding: 4px 8px; 
    border-radius: 4px; 
    font-size: 0.6rem; 
    font-weight: 700; 
    text-transform: uppercase; 
}
.badge-active { background: rgba(74, 222, 128, 0.1); color: var(--color-success); }
.badge-plan { background: rgba(212, 175, 55, 0.1); color: var(--color-gold); border: 1px solid rgba(212, 175, 55, 0.2); }

.btn-details {
    padding: 4px 10px;
    border: 1px solid var(--color-gold);
    color: var(--color-gold);
    font-size: 0.6rem;
    text-decoration: none;
    text-transform: uppercase;
    font-weight: 800;
    border-radius: 4px;
}

/* RESPONSIVE MEDIA QUERIES */
@media (max-width: 1024px) {
    .mobile-header { display: flex; }
    .sidebar { transform: translateX(-100%); }
    .main-content { margin-left: 0; padding: 5rem 1rem 1.5rem 1rem; }
    #nav-toggle:checked ~ .sidebar { transform: translateX(0); }
    
    table { min-width: 800px; } /* Forces scroll on smaller screens */
}

@media (max-width: 768px) {
    .details-grid { grid-template-columns: 1fr; }
    .profile-card { padding: 1.25rem; }
    .button-row { flex-direction: column; }
}

.back-link {
    color: #d4af37; /* Gold theme color */
    text-decoration: none;
    font-size: 0.6rem; /* Small, compact size */
    text-transform: uppercase;
    font-weight: 800; /* Bold for professional feel */
    letter-spacing: 1.5px;
    display: inline-block;
    margin-bottom: 5px;
    transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-family: 'Montserrat', sans-serif;
    cursor: pointer;
}

/* Hover interaction */
.back-link:hover {
    opacity: 0.7;
    transform: translateX(-3px); /* Subtle shift effect */
}
    </style>
</head>
<body>

    <input type="checkbox" id="nav-toggle" class="nav-toggle">

    <header class="mobile-header">
        <div class="logo" style="font-family: 'Playfair Display'; color: var(--color-gold); font-weight: 900;">AK ADMIN</div>
        <label for="nav-toggle" class="hamburger">
            <span></span><span></span><span></span>
        </label>
    </header>

    {% include "Admin/sidebar.html" %}

    <main class="main-content">
        <header class="header-main">
            <a href="{% url 'ayushman_dashboard' %}" class="back-link">‚Üê Back to Dashboard</a>
            <h1>USER PROFILE</h1>
        </header>

        <form class="profile-card" method="POST" action="{% url "customer_profile" user.id %}">
            {% csrf_token %}
            <div class="details-grid">
                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" name="name" value="{{user.name}}">
                </div>
                <div class="input-group">
                    <label>Phone Number</label>
                    <input type="text" name="phone" value="{{user.phone}}">
                </div>
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" name="email" value="{{user.email}}">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" name="password" placeholder="******">
                </div>
                <div class="input-group" style="grid-column: span 2;">
                    <label>Address / Room No.</label>
                    <input type="text" name="address" value="{{user.address}}">
                </div>
                <div class="input-group">
                    <label>Subscription Plan</label>
                    <select name="subscription_choice">
                        <option {% if user.subscription_choice == "NORMAL30" %} selected {% endif %} >NORMAL30</option>
                        <option {% if user.subscription_choice == "NORMAL60" %} selected {% endif %} >NORMAL60</option>
                        <option {% if user.subscription_choice == "FLAGSHIP30" %} selected {% endif %} >FLAGSHIP30</option>
                        <option {% if user.subscription_choice == "FLAGSHIP60" %} selected {% endif %} >FLAGSHIP60</option>
                        <option {% if user.subscription_choice == "PREMIUM30" %} selected {% endif %} >PREMIUM30</option>
                        <option {% if user.subscription_choice == "PREMIUM60" %} selected {% endif %} >PREMIUM60</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Meals Left</label>
                    <input type="number" value="{{user.meal_balance}}" style="color: var(--color-danger); font-weight: bold;" name="meal_balance">
                </div>
                <div class="input-group">
                    <label>Default Lunch Service</label>
                    <select name="default_lunch_service_choice">
                        <option {% if user.default_lunch_service_choice == "Delivery" %}selected{% endif %} >Delivery</option>
                        <option {% if user.default_lunch_service_choice == "DineIn" %}selected{% endif %} >DineIn</option>
                        <option {% if user.default_lunch_service_choice == "PickUp" %}selected{% endif %} >PickUp</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Default Dinner Service</label>
                    <select name="default_dinner_service_choice">
                        <option {% if user.default_dinner_service_choice == "Delivery" %}selected{% endif %} >Delivery</option>
                        <option {% if user.default_dinner_service_choice == "DineIn" %}selected{% endif %} >DineIn</option>
                        <option {% if user.default_dinner_service_choice == "PickUp" %}selected{% endif %} >PickUp</option>
                    </select>
                </div>
            </div>
            <div class="input-group">
                <label>Default Sunday</label>
                <input type="text"  value="{{ user.default_sunday_choice }}" readonly>
            </div>
            <div class="input-group">
                <label>Default Lunch</label>
                <input type="text"  value=" {% firstof user.default_meal_choice user.FLAGSHIP_MENU_LUNCH_default_choice user.PREMIUM_MENU_LUNCH_default_choice %} " readonly>
            </div>
            
            <div class="input-group">
                <label>Default Dinner</label>
                <input type="text"  value=" {% firstof user.default_meal_choice user.FLAGSHIP_MENU_DINNER_default_choice user.PREMIUM_MENU_DINNER_default_choice %} " readonly>
            </div>
            <div class="field-group">
                <label class="field-label">Account States</label>
                <div class="check-row">
                    <label class="inline-label" >
                        <input type="checkbox" name="user_status_active" value="1" {% if user.user_status_active %}checked{% endif %} >
                        User Active
                    </label>
                    <label class="inline-label" >
                        <input type="checkbox" name="lunch_status_active" value="1" {% if user.lunch_status_active %}checked{% endif %} >
                        Lunch Authorized
                    </label>
                    <label class="inline-label" >
                        <input type="checkbox" name="dinner_status_active" value="1" {% if user.dinner_status_active %}checked{% endif %} >
                        Dinner Authorized
                    </label>
                </div>
            </div>

            <div class="button-row">
                <button type="submit" name="action" value="update" class="btn btn-save">Save Changes</button>
                <button type="submit" name="action" value="renew" class="btn btn-renew">Renew Subscription </button>
            </div>
        </form>

        <div class="section-container">
            <h2>Subscription History</h2>
            <div class="table-wrapper">
                <div class="scroll-container">
                    <table>
                        <thead>
                            <tr>
                                <th>S.No.</th>
                                <th>Phase</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Plan Type</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sub in subs_history %}
                            <tr>
                                <td>{{forloop.counter}}</td>
                                <td><span class="badge badge-active">{{sub.subscription_phase}}</span></td>
                                <td>{{sub.start_date}}</td>
                                <td>{{sub.end_date}}</td>
                                <td><span class="badge badge-plan">{{sub.subscription_choice}}</span></td>
                                <td data-label="Actions" style="text-align: center;">
                                    <a href="{% url 'track_subscription_details' sub.id %}" class="btn-details">Details</a>
                                </td>   
                            </tr>
                            {% empty %}
                                <tr> <td colspan=6>Not Yet Renewed</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="section-container">
            <h2>Current Subscription Meal History</h2>
            <div class="table-wrapper">
                <div class="scroll-container">
 <table class="data-table history-table">
                        <thead>
                            <tr>
                                <th>S.No.</th>
                                <th>Date</th>
                                <th>Meal Type</th>
                                <th>Service</th>
                                <th>Meal Choice</th>
                                <th>Meal No. Used</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in current_meal_history %}
                            <tr>
                                <td>{{forloop.counter}}</td>
                                <td data-label="Date">{{ row.date|date:"d M Y" }}</td>
                                <td data-label="Meal Type">{{ row.meal_type }}</td>
                                <td data-label="Service">{{ row.service }}</td>
                                <td data-label="Meal Choice">{{row.meal_choice}}</td>
                                <td data-label="Meal No. Used">{{row.meal_no}}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center">No meal history found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>

                    </table>
                </div>
            </div>
        </div>
    </main>
</body>
</html>