{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>User Dashboard - Hotel Meal Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="{% static 'Customer/styles-user-dashboard.css' %}"/>
</head>
<body>
    {% include "Customer/navbar.html" %}
    <main class="user-page">
        <div class="content-container">
            {% if admin_notice %}
            {% for m in admin_notice %}
            <div class="message-banner info" role="alert">
                <p> Message : {{m.message}}.</p>
            </div>
            {% endfor %}
            {% endif %}
            {% if request.user.meal_balance <= 4 %}
            <div class="message-banner warning" role="alert">
                <p>
                    ‚ö†Ô∏è <strong>Low Meal Alert!</strong>
                    You have <strong>{{ request.user.meal_balance }}</strong> meals left.
                    Please renew your plan soon to avoid interruption.
                </p>
            </div>
            {% endif %}

            


        </div>
        <div class="user-container">
            <!-- greeting uses real user info from context -->
            <h1 class="page-title" id="userGreeting">WELCOME {{ request.user.name|upper }}</h1>
            <p class="user-plan-display" id="userPlanDisplay">Your Current Plan: {{request.user.subscription_choice}}</p>

            <section class="meal-counters" aria-label="Meal counters">
                
                <div class="counter-card">
                    <div class="counter-icon">üìä</div>
                    <div class="counter-content">
                        <p class="counter-label">Meals Available</p>
                        <p class="counter-number" id="mealsAvailable">{{ request.user.meal_balance|default:"0" }}</p>
                    </div>
                </div>

                <div class="counter-card">
                    <div class="counter-icon">üçΩÔ∏è</div>
                    <div class="counter-content">
                        <p class="counter-label">Meals Used</p>
                        <p class="counter-number" id="mealsUsed">{{used_meals}}</p>
                    </div>
                </div>
                
                <div class="counter-card">
                    <div class="counter-icon">‚ùå</div>
                    <div class="counter-content">
                        <p class="counter-label">Meals Cancelled</p>
                        <p class="counter-number" id="mealsCancelled">{{ cancelled_meals|default:"0" }}</p>
                    </div>
                </div>
            </section>
            
            <section class="today-meals">

                {% if request.user.user_status_active %}
                <h2 class="section-title"> {% now "Y-m-d" %} </h2>
                <h2 class="section-title">Today's Meals  </h2>
                {% else %}
                {% if request.user.paused_subscription   %}
                <p class="section-title">0 Meals Left! Subscribe to restart services</p>
                {% else %}
                <p class="section-title">Resume meals in profile to resume services</p>
                {% endif %}
                {% endif %}

                
                
                <div class="meals-grid">
                    {% if request.user.lunch_status_active %}
                        {% if lunch_record %}
                            <div class="meal-card locked-card">
                                <div class="meal-time">Lunch</div>
                                    {% if lunch_record.service_choice == "Cancel" %}
                                        <div class="meal-details">
                                            <p class="meal-course">Meal Cancelled</p>
                                        </div>
                                        <div class="meal-status-message cancelled">
                                            <p>Thank you for letting us know.</p>
                                        </div>
                                    {% else %}
                                        <div class="meal-details">
                                            <p class="meal-course">Meal Confirmed! *Thank You* </p>
                                        </div>
                                        <div class="meal-status-message">                    
                                            <p>Food Chosen: *{% firstof lunch_record.meal_choice lunch_record.FLAGSHIP_choice lunch_record.PREMIUM_choice %}*</p>                                                                      
                                                <p>Service Chosen: *{{lunch_record.service_choice}}*</p>    
                                        </div> 
                                    {% endif %}            
                                </div>      
                            </div>


                        {% else %}
                            {% if request.user.user_status_active %}
                            <!-- Lunch Card -->
                            <div class="meal-card" data-meal="lunch">
                                <div class="meal-time">Lunch</div>
                                <p class="meal-description" id="lunchDescription">Please update Meal details before 11.00 AM. </p>
                                <form method="POST" action="{% url 'userlunch' %}">   
                                    {% csrf_token %} 
                                    <div class="meal-details">
                                    
                                        <p class="meal-course">Select Food</p>
                                        {% if request.user.subscription_choice == "NORMAL30" or request.user.subscription_choice == "NORMAL60" %}
                                            <select id="lunchFoodType" class="food-type-dropdown" name="meal_choice">
                                                <option value="default" disabled>Choose your food</option>
                                                <option value="VEG" {% if request.user.default_meal_choice == "VEG" %}selected{% endif %}>VEG</option>
                                                <option value="NON-VEG" {% if request.user.default_meal_choice == "NON-VEG" %}selected{% endif %}>NON-VEG</option>
                                            </select>

                                        {% endif %}
                                        {% if request.user.subscription_choice == "FLAGSHIP30" or request.user.subscription_choice == "FLAGSHIP60" %}
                                            <select id="lunchFoodType" class="food-type-dropdown" name="FLAGSHIP_choice">
                                                <option value="default" disabled>Choose your food</option>
                                                <option value="PANEER" {% if request.user.FLAGSHIP_MENU_LUNCH_default_choice == "PANEER" %}selected{% endif %}>PANEER</option>
                                                <option value="MUSHROOM" {% if request.user.FLAGSHIP_MENU_LUNCH_default_choice == "MUSHROOM" %}selected{% endif %}>MUSHROOM</option>
                                                <option value="CHICKEN" {% if request.user.FLAGSHIP_MENU_LUNCH_default_choice == "CHICKEN" %}selected{% endif %}>CHICKEN</option>
                                            </select>
                                        {% endif %}
                                        {% if request.user.subscription_choice == "PREMIUM30" or request.user.subscription_choice == "PREMIUM60" %}
                                            <select id="lunchFoodType" class="food-type-dropdown" name="PREMIUM_choice">
                                                <option value="default" disabled>Choose your food</option>
                                                <option value="PANEER" {% if request.user.PREMIUM_MENU_LUNCH_default_choice == "PANEER" %}selected{% endif %}>PANEER</option>
                                                <option value="MUSHROOM" {% if request.user.PREMIUM_MENU_LUNCH_default_choice == "MUSHROOM" %}selected{% endif %}>MUSHROOM</option>
                                                <option value="CHICKEN" {% if request.user.PREMIUM_MENU_LUNCH_default_choice == "CHICKEN" %}selected{% endif %}>CHICKEN</option>
                                                <option value="EGG" {% if request.user.PREMIUM_MENU_LUNCH_default_choice == "EGG" %}selected{% endif %}>EGG</option>
                                                <option value="PRAWN" {% if request.user.PREMIUM_MENU_LUNCH_default_choice == "PRAWN" %}selected{% endif %}>PRAWN</option>
                                                <option value="FISH" {% if request.user.PREMIUM_MENU_LUNCH_default_choice == "FISH" %}selected{% endif %}>FISH</option>
                                                <option value="VEG" {% if request.user.PREMIUM_MENU_LUNCH_default_choice == "VEG" %}selected{% endif %}>VEG</option>
                                            </select>
                                        {% endif %}
                                    </div>

                                    <div class="meal-actions radio-group" id="lunchServiceOptions">
                                        <input type="radio" id="lunch-dining" name="lunch_service" value="DineIn"
                                            {% if request.user.default_lunch_service_choice == "DineIn" %}checked{% endif %}>
                                        <label for="lunch-dining" class="radio-label btn-dining">DineIn</label>

                                        <input type="radio" id="lunch-pickup" name="lunch_service" value="PickUp"
                                            {% if request.user.default_lunch_service_choice == "PickUp" %}checked{% endif %}>
                                        <label for="lunch-pickup" class="radio-label btn-pickup">Pickup</label>

                                        <input type="radio" id="lunch-delivery" name="lunch_service" value="Delivery"
                                            {% if request.user.default_lunch_service_choice == "Delivery" %}checked{% endif %}>
                                        <label for="lunch-delivery" class="radio-label btn-delivery">Delivery</label>

                                        <input type="radio" id="lunch-cancel" name="lunch_service" value="Cancel"
                                            {% if request.user.default_lunch_service_choice == "Cancel" %}checked{% endif %}>
                                        <label for="lunch-cancel" class="radio-label btn-cancel">Cancel</label>
                                    </div>
                                    
                                    <button class="btn btn-primary btn-confirm" data-meal-type="Lunch" id="btnConfirmLunch">Confirm Selection</button>
                                </form>
                            </div>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                        
                    {% if request.user.dinner_status_active %}
                        {% if dinner_record  %}
                            <div class="meal-card locked-card">
                                <div class="meal-time">Dinner</div>
                                    {% if dinner_record.service_choice == "Cancel" %}
                                        <div class="meal-details">
                                            <p class="meal-course">Meal Cancelled</p>
                                        </div>
                                        <div class="meal-status-message cancelled">
                                            <p>Thank you for letting us know.</p>
                                        </div>
                                    {% else %}
                                        <div class="meal-details">
                                            <p class="meal-course">Meal Confirmed! *Thank You* </p>
                                        </div>
                                        <div class="meal-status-message">         
                                            <p>Food Chosen: *{% firstof dinner_record.meal_choice dinner_record.FLAGSHIP_choice dinner_record.PREMIUM_choice %}*</p>                                                                                 <p>Service Chosen: *{{dinner_record.service_choice}}*</p>    
                                        </div> 
                                    {% endif %}            
                                </div>      
                            </div>


                        {% else %}
                            {% if request.user.user_status_active %}
                            <!-- Dinner Card -->
                            <div class="meal-card" data-meal="dinner">
                                <div class="meal-time">Dinner</div>
                                <p class="meal-description" id="dinnerDescription">Please update Meal details before 07.00 PM. </p>
                                <form method="POST" action="{% url 'userdinner' %}">
                                    {% csrf_token %}

                                    <div class="meal-details">
                                        <p class="meal-course">Select Food</p>

                                        {% if request.user.subscription_choice == "NORMAL30" or request.user.subscription_choice == "NORMAL60" %}
                                            <select id="dinnerFoodType_normal" class="food-type-dropdown" name="meal_choice">
                                                <option value="default" disabled {% if not request.user.default_meal_choice %}selected{% endif %}>Choose your food</option>
                                                <option value="VEG" {% if request.user.default_meal_choice == "VEG" %}selected{% endif %}>VEG</option>
                                                <option value="NON-VEG" {% if request.user.default_meal_choice == "NON-VEG" %}selected{% endif %}>NON-VEG</option>
                                            </select>
                                        {% endif %}

                                        {% if request.user.subscription_choice == "FLAGSHIP30" or request.user.subscription_choice == "FLAGSHIP60" %}
                                            <select id="dinnerFoodType_flagship" class="food-type-dropdown" name="FLAGSHIP_choice">
                                                <option value="default" disabled >Choose your food</option>
                                                <option value="PANEER" {% if request.user.FLAGSHIP_MENU_DINNER_default_choice == "PANEER" %}selected{% endif %}>PANEER</option>
                                                <option value="MUSHROOM" {% if request.user.FLAGSHIP_MENU_DINNER_default_choice == "MUSHROOM" %}selected{% endif %}>MUSHROOM</option>
                                                <option value="CHICKEN" {% if request.user.FLAGSHIP_MENU_DINNER_default_choice == "CHICKEN" %}selected{% endif %}>CHICKEN</option>
                                            </select>
                                        {% endif %}

                                        {% if request.user.subscription_choice == "PREMIUM30" or request.user.subscription_choice == "PREMIUM60" %}
                                            <select id="dinnerFoodType_premium" class="food-type-dropdown" name="PREMIUM_choice">
                                                <option value="default" disabled >Choose your food</option>
                                                <option value="PANEER" {% if request.user.PREMIUM_MENU_DINNER_default_choice == "PANEER" %}selected{% endif %}>PANEER</option>
                                                <option value="MUSHROOM" {% if request.user.PREMIUM_MENU_DINNER_default_choice == "MUSHROOM" %}selected{% endif %}>MUSHROOM</option>
                                                <option value="CHICKEN" {% if request.user.PREMIUM_MENU_DINNER_default_choice == "CHICKEN" %}selected{% endif %}>CHICKEN</option>
                                                <option value="EGG" {% if request.user.PREMIUM_MENU_DINNER_default_choice == "EGG" %}selected{% endif %}>EGG</option>
                                                <option value="VEG" {% if request.user.PREMIUM_MENU_DINNER_default_choice == "VEG" %}selected{% endif %}>VEG</option>
                                            </select>
                                        {% endif %}
                                    </div>

                                    <div class="meal-actions radio-group" id="dinnerServiceOptions">
                                        <input type="radio" id="dinner-dining" name="dinner_service" value="DineIn"
                                            {% if request.user.default_dinner_service_choice == "DineIn" %}checked{% endif %}>
                                        <label for="dinner-dining" class="radio-label btn-dining">DineIn</label>

                                        <input type="radio" id="dinner-pickup" name="dinner_service" value="PickUp"
                                            {% if request.user.default_dinner_service_choice == "PickUp" %}checked{% endif %}>
                                        <label for="dinner-pickup" class="radio-label btn-pickup">Pickup</label>

                                        <input type="radio" id="dinner-delivery" name="dinner_service" value="Delivery"
                                            {% if request.user.default_dinner_service_choice == "Delivery" %}checked{% endif %}>
                                        <label for="dinner-delivery" class="radio-label btn-delivery">Delivery</label>

                                        <input type="radio" id="dinner-cancel" name="dinner_service" value="Cancel"
                                            {% if request.user.default_dinner_service_choice == "Cancel" %}checked{% endif %}>
                                        <label for="dinner-cancel" class="radio-label btn-cancel">Cancel</label>
                                    </div>

                                    <button class="btn btn-primary btn-confirm" data-meal-type="Dinner" id="btnConfirmDinner">Confirm Selection</button>
                                </form>

                            </div>
                            {% endif %}
                        {% endif %}
                    {% endif %}

                    {% if tsunday %}
                    {% if request.user.lunch_status_active %}
                        {% if slunch_record %}
                            <div class="meal-card locked-card">
                                <div class="meal-time" style="background-color:Red;">Sunday Lunch</div>
                                    {% if slunch_record.service_choice == "Cancel" %}
                                        <div class="meal-details">
                                            <p class="meal-course">Meal Cancelled</p>
                                        </div>
                                        <div class="meal-status-message cancelled">
                                            <p>Thank you for letting us know.</p>
                                        </div>
                                    {% else %}
                                        <div class="meal-details">
                                            <p class="meal-course">Meal Confirmed! *Thank You* </p>
                                        </div>
                                        <div class="meal-status-message">               
                                            <p>Food Chosen: *{{ slunch_record.meal_choice  }}*</p>                                                                       
                                            <p>Service Chosen: *{{slunch_record.service_choice}}*</p>    
                                        </div> 
                                    {% endif %}            
                                </div>      
                            </div>


                        {% else %}
                            {% if request.user.user_status_active %}
                            <!-- Lunch Card -->
                            <div class="meal-card" data-meal="lunch">
                                <div class="meal-time" style="background-color:Red;">Sunday Lunch</div>
                                <p class="meal-description" id="lunchDescription">Please update Tommorow's Meal before 11.00 PM today. </p>
                                <form method="POST" action="{% url 'usersundaylunch' %}">   
                                    {% csrf_token %} 
                                    <div class="meal-details">
                                        <p class="meal-course">Select Food</p>
                                            <select id="lunchFoodType" class="food-type-dropdown" name="meal_choice">
                                                <option value="default" disabled>Choose your food</option>
                                                <option value="VEG" {% if request.user.default_meal_choice == "VEG" %}selected{% endif %}>VEG</option>
                                                <option value="NON-VEG" {% if request.user.default_meal_choice == "NON-VEG" %}selected{% endif %}>NON-VEG</option>
                                            </select>
                                    </div>

                                    <div class="meal-actions radio-group" id="lunchServiceOptions">
                                        <input type="radio" id="sundaylunch-dining" name="lunch_service" value="DineIn"
                                            {% if request.user.default_lunch_service_choice == "DineIn" %}checked{% endif %}>
                                        <label for="sundaylunch-dining" class="radio-label btn-dining">DineIn</label>

                                        <input type="radio" id="sundaylunch-pickup" name="lunch_service" value="PickUp"
                                            {% if request.user.default_lunch_service_choice == "PickUp" %}checked{% endif %}>
                                        <label for="sundaylunch-pickup" class="radio-label btn-pickup">Pickup</label>

                                        <input type="radio" id="sundaylunch-delivery" name="lunch_service" value="Delivery"
                                            {% if request.user.default_lunch_service_choice == "Delivery" %}checked{% endif %}>
                                        <label for="sundaylunch-delivery" class="radio-label btn-delivery">Delivery</label>

                                        <input type="radio" id="sundaylunch-cancel" name="lunch_service" value="Cancel"
                                            {% if request.user.default_lunch_service_choice == "Cancel" %}checked{% endif %}>
                                        <label for="sundaylunch-cancel" class="radio-label btn-cancel">Cancel</label>
                                    </div>
                                    
                                    <button class="btn btn-primary btn-confirm" data-meal-type="Lunch" id="btnConfirmLunch">Confirm Selection</button>
                                </form>
                            </div>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                    {% endif %}
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Ayushman's Kitchen. All rights reserved.</p>
    </footer>
</body>
</html>
